@section styles{

}

@model List<FRIO.MAR.APPLICATION.CORE.DTOs.DomainService.VentasDomainServiceResultDto>
@if (Model != null && Model.Any())
{
    <table id="datatable-documentos-emitidos" class="table table-striped table-bordered nowrap table-hover" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
        <thead class="thead-light">
            <tr>
                <th class="text-center">Acciones</th>
                <th class="text-center">Fecha Facturación</th>
                <th class="text-center">NIT Receptor</th>
                <th class="text-center">Razón Social Receptor</th>
                <th class="text-center">Subtotal</th>
                <th class="text-center">Total</th>
                <th class="text-left">Observación</th>
            </tr>
        </thead>
        <tbody>
            @foreach (FRIO.MAR.APPLICATION.CORE.DTOs.DomainService.VentasDomainServiceResultDto row in Model)
            {
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="card">
        <div class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
            La consulta no devolvió ningún resultado.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
}

<!-- Datatable init js -->
<script>
    $(document).ready(function () {
        // INICIO DATATABLE
        $("#datatable").DataTable(),
            $("#datatable-documentos-emitidos").DataTable({
                scrollX: true,
                paging: true,
                ordering: true,
                info: true,
                pageLength: 10,
                searching: true,
                responsive: false,
                language: {
                    processing: 'Procesando...',
                    search: "Buscar: _INPUT_",
                    lengthMenu: '   Mostrar _MENU_ registros',
                    info: 'Mostrando desde _START_ al _END_ de _TOTAL_ registros',
                    infoEmpty: 'Mostrando ningún elemento.',
                    infoFiltered: '(filtrado _MAX_ elementos total)',
                    infoPostFix: '',
                    loadingRecords: 'Cargando registros...',
                    zeroRecords: 'No se encontraron registros',
                    emptyTable: 'No hay datos disponibles en la tabla',
                    paginate: {
                        first: 'Primero',
                        previous: 'Anterior',
                        next: 'Siguiente',
                        last: 'Último'
                    }
                },
                lengthChange: !1,
                buttons: [{
                    extend: 'pdfHtml5',
                    orientation: 'landscape',
                    pageSize: 'LEGAL',
                    customize: function (doc, config) {
                        var tableNode;
                        for (i = 0; i < doc.content.length; ++i) {
                            if (doc.content[i].table !== undefined) {
                                tableNode = doc.content[i];
                                break;
                            }
                        }

                        var rowIndex = 0;
                        var tableColumnCount = tableNode.table.body[rowIndex].length;

                        if (tableColumnCount > 5) {
                            doc.pageOrientation = 'landscape';
                        }
                    }
                }, "excel",
                {
                    //className: 'btn btn-success btn-rounded',
                    text: 'ZIP',
                    titleAttr: 'Descargar archivos',
                    action: function (e, dt, node, config) {

                        try {
                            IniciarLoading(500000);
                            $.get('@Url.Action("DescargarArchivosEmision", "Reporte")',
                                {
                                    tipoDocumento: $("#tipoDocumento").val(),
                                    estadoEdoc: $("#estadoEdoc").val(),
                                    fechaInicio: $("#fechaInicio2").val(),
                                    fechaFin: $("#fechaFin2").val()
                                })
                                .done(function (response) {
                                    responseURL = response;

                                    switch (response) {
                                        case "--NO_ZIP":
                                            Swal.fire({
                                                title: '¡No ZIP!',
                                                text: 'No se ha podido generar el .zip del documento.',
                                                type: "warning",
                                                confirmButtonText: 'OK',
                                                allowOutsideClick: false,
                                            });
                                            break;
                                        case "--NO_ADJUNTOS_SERVICIO":
                                            Swal.fire({
                                                title: '¡No existen adjuntos!',
                                                text: 'El documento no posee adjuntos.',
                                                type: "info",
                                                confirmButtonText: 'OK',
                                                allowOutsideClick: false,
                                            });
                                            break;
                                        case "--ZIP_VACIO":
                                            Swal.fire({
                                                title: '¡El .zip vacío!',
                                                text: 'El .zip está vacío.',
                                                type: "info",
                                                confirmButtonText: 'OK',
                                                allowOutsideClick: false,
                                            });
                                            break;

                                        default:
                                                window.location = "@Url.Action("DownloadZip", "Reporte")" + '?fileGuid=' + response + '&filename=' + response;
                                                Swal.close();
                                            break;
                                    }
                                })
                                .fail(function (error) { MsgAjaxError(error); } )
                        } catch (e) {
                            MsgAjaxError(e)
                        }
                    }
                }]
            }).buttons().container().appendTo("#datatable-documentos-emitidos_wrapper .col-md-6:eq(0)");
         // FIN DATATABLE
    });
</script>